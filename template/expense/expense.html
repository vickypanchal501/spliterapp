<!-- {% load static %} -->


<!-- MATERIAL DESIGN ICONIC FONT -->
<!-- <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css"> -->
<!-- STYLE CSS -->
<link href="{% static 'css/expense/style.css.map' %}" rel="stylesheet" />
<link href="{% static 'css/expense/style.css' %}" rel="stylesheet" />
<!-- <link href="{% static 'css/expense/style.scss' %}" rel="stylesheet" /> -->


<!-- <div class="modal-content" style="background: none;"> -->

<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <!-- <div class="modal-dialog modal-dialog-centered" role="document"> -->
    <div class="wrapper" style="max-width: 100%; margin: auto 0px;">
        <!-- <form action=""> -->
        <div id="wizard" role="application" class="wizard clearfix">
            {% if group.id %}
            <form method="post" action="{% url 'add_expense' group_id=group.id %}">
                <div class="content clearfix">
                    {% csrf_token %}
                    <h4 id="wizard-h-0" tabindex="-1" class="title current"></h4>
                    <section id="wizard-p-0" role="tabpanel" aria-labelledby="wizard-h-0" class="body current"
                        aria-hidden="false">
                        <div class="form-header">
                            <div class="avartar">
                                <a href="#">
                                    <img class="img-fluid" style="max-width: 85%;"
                                        src="https://api.multiavatar.com/{{group}}.svg" alt="">
                                </a>

                            </div>
                            <div class="form-group" style="margin: auto;">
                                <div class="form-holder active" style="color: brown;">
                                    <input type="text" placeholder="Add Description" class="form-control"
                                        name="description" id="description" required>
                                </div>
                                <div class="form-holder">
                                    <input type="number" placeholder="Add Amount" class="form-control"
                                        name="split_amount" step="0.01" id="split_amount" required>
                                </div>

                            </div>
                        </div>

                        <div class="human_summary">Paid by <a class="payer">
                                <select style="background: none; font-size: 16px; color: #f8b739; width: 90px;"
                                    name="paid_by" id="paid_by">
                                    {% for user in group.members.all %}
                                    <option style="color: #f8b739; padding: 10px; text-align: center;"
                                        value="{{ user.id }}"  {% if user.id == request.user.id %}selected{% endif %}> {{ user.username }}
                                    </option>
                                    {% endfor %}
                                </select></a> and split

                            <a class="split" style="color: #f8b739 ; padding: 4px; font-size: 16px; text-align: center;"
                                data-toggle="modal" data-target="#exampleModalong">
                                equally
                            </a>​.

                        </div>
                        <div style="display: flex; justify-content: center; font-size: 18p;" class="details">(
                            <span id="split-amount-user"> ₹
                                <span id="split-amount-per-user"></span> /person
                            </span>
                            <span id='get-back-amount'></span>)
                        </div>

                        {% include 'expense/checkbox.html' %}

                    </section>

                </div>
                <div class="actions clearfix">
                    <ul role="menu" aria-label="Pagination">
                        <li class="" aria-disabled="false"><a
                                href="{% url 'group_detail' group_id=group.id %}"="menuitem">Back</a></li>
                        <li aria-hidden="false" aria-disabled="false"><a> <button type="submit"
                                    style="background: none; border: none; font-size: 17px; color: #fff;">Continue</button></a>
                        </li>

                    </ul>
                </div>

            </form>
            {%endif%}
        </div>
    </div>
</div>
<!-- Display amount paid by the user -->

</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Function to handle the click event on tabs
    function setSplitType(type) {
        const $splitAmountPerUser = $("#split-amount-user");
        const $getBackAmount = $("#get-back-amount");

        // Hide both elements initially
        $splitAmountPerUser.hide();
        $getBackAmount.hide();

        // Show the appropriate element based on the clicked tab
        if (type === 'equal') {
            $splitAmountPerUser.show();
        } else if (type === 'percentage') {
            $getBackAmount.show();
        }
    }

    // Rest of your existing JavaScript code
    $(document).ready(function () {
        const $splitAmountField = $("#split_amount");
        const $splitWithCheckboxes = $("input[name='split_with']");
        const $splitAmountPerUser = $("#split-amount-per-user");
        const $getBackAmount = $("#get-back-amount");
        const $paidBySelect = $("#paid_by");
        let percentagesClicked = false;

        $splitAmountField.on("input", updateSplitAmount);
        $splitWithCheckboxes.on("change", updateSplitAmount);

        $("input[id^='percentage']").on("input", function () {
            percentagesClicked = true;
            updateSplitAmount();
        });

        function updateSplitAmount() {
            const totalAmount = parseFloat($splitAmountField.val()) || 0;
            const selectedParticipants = $splitWithCheckboxes.filter(":checked");
            const numberOfParticipants = selectedParticipants.length;
            const splitAmount = numberOfParticipants > 0 ? totalAmount / numberOfParticipants : 0;

            $splitAmountPerUser.text(splitAmount.toFixed(2));

            if (percentagesClicked) {
                updateGetBackAmount();
            }
        }

        function updateGetBackAmount() {
            const totalAmount = parseFloat($splitAmountField.val()) || 0;
            const selectedParticipants = $splitWithCheckboxes.filter(":checked");
            const numberOfParticipants = selectedParticipants.length;

            const getBackAmount = {};
            const activeUserId = $paidBySelect.val();

            selectedParticipants.each(function () {
                const userId = $(this).val();
                const userPercentage = parseFloat($(`#percentage-${userId}`).val()) || 0;
                const userAmountSpent = totalAmount * (userPercentage / 100);

                getBackAmount[userId] = userAmountSpent.toFixed(2);
            });

            if (getBackAmount.hasOwnProperty(activeUserId)) {
                const owedAmount = getBackAmount[activeUserId];
                $getBackAmount.text(owedAmount > 0 ? `You Owe: ₹${owedAmount}` : "You owe nothing");
            } else {
                $getBackAmount.text("You owe nothing");
            }
        }
    });
</script>

</script>




<script src="{% static 'js/expense/main.js' %}"></script>
<script src="{% static 'js/expense/jquery.steps.js' %}"></script>
<script src="{% static 'js/expense/theme-map.js' %}"></script>

<script src="{% static 'js/expense/jquery-3.3.1.min.js' %}"></script>

<!-- Template created and distributed by Colorlib -->

<!-- <!DOCTYPE html>
<html>
<head>
    <title>Add Expense</title>
</head>
<body>
    <h1>Add Expense</h1>
    <form method="post">
        {% csrf_token %}
        <label for="description">Description:</label>
        <input type="text" name="description" id="description" required>
        
        <label for="split_amount">Amount:</label>
        <input type="number" name="split_amount" step="0.01" id="split_amount" required>

        <label>Participants:</label>
        <div class="participants-checkbox" >
            {% for user in group.members.all %}
                <label>
                    <input type="checkbox" name="split_with" id="split_with" value="{{ user.id }}">
                    {{ user.username }}
                </label>
            {% endfor %}
        </div>

        <label for="split_amount_per_user">Split Amount Per User:</label>
        <div id="split-amount-per-user"></div>

        <label for="paid_by">Paid by:</label>
        <select name="paid_by" id="paid_by">
            {% for user in group.members.all %}
                <option value="{{ user.id }}">{{ user.username }}</option>
            {% endfor %}
        </select>
        
        <button type="submit">Add Expense</button>
    </form>




</body>
</html> 
 -->